NEXORA SECURITY FIXES - OPERATIONAL CHECKLIST
===============================================

SECTION 1: PRE-DEPLOYMENT VERIFICATION
===============================================

Code Quality:
  [ ] All modified files have no syntax errors
  [ ] TypeScript compilation succeeds (ignore pre-existing test errors)
  [ ] No breaking changes to existing functionality
  [ ] Application builds without errors: npm run build

Frontend Testing:
  [ ] Development mode works: npm run dev
  [ ] Production build works: npm run build && npm start
  [ ] Login/signup functionality operational
  [ ] Dashboard loads without CSP errors
  [ ] All inline scripts execute properly
  [ ] No console warnings or errors

Backend Testing:
  [ ] Backend starts without errors: npm run start (in backend/)
  [ ] API endpoints respond normally
  [ ] Authentication still working
  [ ] Database connectivity verified
  [ ] Redis connectivity verified

Application Integration:
  [ ] Frontend can communicate with backend
  [ ] API calls authenticate properly
  [ ] WebSocket connections work if applicable
  [ ] Error handling works as expected
  [ ] File uploads/downloads functional

SECTION 2: SECURITY VERIFICATION
===============================================

CSP Nonce Implementation:
  [ ] nonce is generated per-request (middleware.ts line 8)
  [ ] nonce is injected into CSP header (middleware.ts line 37)
  [ ] nonce is passed to layout.tsx (app/layout.tsx line 84)
  [ ] nonce is applied to inline scripts in layout
  [ ] Meta tag stores nonce for client-side access
  [ ] Production CSP contains 'strict-dynamic' (not 'unsafe-inline')
  [ ] Development CSP contains 'unsafe-inline' (for development convenience)

Health Endpoint Protection:
  [ ] /health endpoint requires API key (if external)
  [ ] /health/database requires JWT authentication
  [ ] /health/redis requires JWT authentication
  [ ] /health/kafka requires JWT authentication
  [ ] All detailed health endpoints protected
  [ ] Access attempts logged to audit trail
  [ ] Logging middleware functioning (logHealthAccess)

Access Control Implementation:
  [ ] HEALTH_ENDPOINT_API_KEYS environment variable documented
  [ ] API key validation function working (validateHealthApiKey)
  [ ] Internal IP detection working (isInternalNetwork, isPrivateIP)
  [ ] Constant-time comparison implemented (constantTimeCompare)
  [ ] Tiered access levels enforced (basic/lite/detailed)

SECTION 3: CONFIGURATION VERIFICATION
===============================================

Environment Variables:
  [ ] HEALTH_ENDPOINT_API_KEYS populated in .env
  [ ] NODE_ENV set correctly (development or production)
  [ ] JWT_SECRET configured
  [ ] DATABASE_URL configured
  [ ] REDIS_URL configured
  [ ] All required env vars set

Security Headers:
  [ ] X-Frame-Options: DENY (set in next.config.js line 46)
  [ ] X-Content-Type-Options: nosniff (set in next.config.js line 51)
  [ ] Referrer-Policy: no-referrer (set in next.config.js line 58)
  [ ] Strict-Transport-Security: max-age=63072000 (production only)
  [ ] Content-Security-Policy: Proper nonce implementation

Application Configuration:
  [ ] CORS properly configured
  [ ] Rate limiting enabled
  [ ] Authentication middleware applied
  [ ] Tenant isolation enforced
  [ ] Subscription checking enabled

SECTION 4: DEPLOYMENT CHECKLIST
===============================================

Pre-Deployment:
  [ ] Code reviewed and approved
  [ ] All tests passing (except pre-existing test errors)
  [ ] Security fixes documented in SECURITY-FIXES-TESTING-GUIDE.txt
  [ ] Rollback plan reviewed (see SECTION 5 below)
  [ ] Database backups created
  [ ] Current application state documented

Deployment Steps:
  [ ] 1. Deploy frontend changes (next.config.js, middleware.ts, app/layout.tsx, src/hooks/useNonce.ts)
  [ ] 2. Deploy backend changes (health-access.middleware.ts, health.routes.ts)
  [ ] 3. Update environment variables (HEALTH_ENDPOINT_API_KEYS)
  [ ] 4. Restart application services
  [ ] 5. Run smoke tests (see SECTION 5)
  [ ] 6. Monitor error logs for the first hour
  [ ] 7. Verify metrics and alerts working

Post-Deployment:
  [ ] CSP headers verified via curl
  [ ] Health endpoints responding correctly
  [ ] Monitoring systems can access health endpoints
  [ ] No increase in error rates
  [ ] Application performance metrics normal
  [ ] User authentication working normally
  [ ] No CSP violation reports in console
  [ ] Audit logs showing health endpoint access

SECTION 5: SMOKE TESTS (Run after deployment)
===============================================

CSP Nonce Test:
  [ ] curl -I https://your-app.com | grep "nonce-"
      Should show: Content-Security-Policy: ... 'nonce-XXXXX' ...

Health Endpoint Test (Public Access - Should FAIL):
  [ ] curl http://api.your-app.com/health
      Should return: 403 Forbidden

Health Endpoint Test (With API Key - Should SUCCEED):
  [ ] curl -H "X-API-Key: YOUR_KEY" http://api.your-app.com/health
      Should return: 200 OK with {"status":"healthy",...}

Health Endpoint Test (With JWT - Detailed, Should SUCCEED):
  [ ] Get JWT token from login
  [ ] curl -H "Authorization: Bearer TOKEN" http://api.your-app.com/health/database
      Should return: 200 OK with database health info

No Script Errors Test:
  [ ] Open app in browser
  [ ] Check DevTools Console (F12)
  [ ] Should have NO CSP or script execution errors
  [ ] All page features should work normally

SECTION 6: ROLLBACK PLAN (Emergency Use Only)
===============================================

If Critical Issue Detected:

Immediate Action:
  [ ] Roll back to previous commit
  [ ] git revert [commit-hash]
  [ ] Restart application
  [ ] Verify application functionality restored

Partial Rollback (If needed):

To disable nonce (LAST RESORT):
  [ ] Comment out nonce injection in middleware.ts line 37-41
  [ ] CSP will revert to 'unsafe-inline'
  [ ] WARNING: This is a security downgrade

To disable health endpoint protection (EMERGENCY ONLY):
  [ ] Comment out requireLiteHealthAccess from health.routes.ts
  [ ] Health endpoints will become public again
  [ ] WARNING: This exposes system internals

Post-Rollback:
  [ ] Run smoke tests again
  [ ] Verify all functionality restored
  [ ] Document what went wrong
  [ ] Fix the issue in development environment
  [ ] Redeploy after testing

SECTION 7: MONITORING & ALERTING
===============================================

Set Up Monitoring:

CSP Violations:
  [ ] Configure CSP report-uri in next.config.js
  [ ] Set up violation report collection
  [ ] Create alert for CSP violations > threshold
  [ ] Monitor for patterns indicating attacks

Health Endpoint Access:
  [ ] Monitor /health endpoint access logs
  [ ] Alert on 403 Forbidden responses (potential attacks)
  [ ] Alert on 401 Unauthorized (misconfiguration)
  [ ] Track successful health checks (should be consistent)

System Performance:
  [ ] Monitor application response times
  [ ] Monitor health endpoint latencies
  [ ] Monitor database connection pool usage
  [ ] Monitor Redis connection pool usage
  [ ] Monitor API error rates

Security Metrics:
  [ ] Track failed authentication attempts
  [ ] Track API key validation failures
  [ ] Track access control violations
  [ ] Monitor for unusual access patterns

SECTION 8: ONGOING MAINTENANCE
===============================================

Daily:
  [ ] Check error logs for CSP violations
  [ ] Verify health endpoint access patterns normal
  [ ] Monitor application performance metrics
  [ ] Check that backups completed successfully

Weekly:
  [ ] Review security audit logs
  [ ] Check for unauthorized access attempts
  [ ] Review CSP violation reports
  [ ] Verify monitoring/alerting systems working

Monthly:
  [ ] Rotate HEALTH_ENDPOINT_API_KEYS if using long-lived keys
  [ ] Review and update security configuration if needed
  [ ] Update Next.js and dependencies if updates available
  [ ] Test disaster recovery procedures

Quarterly:
  [ ] Full security audit of implementation
  [ ] Penetration testing (if applicable)
  [ ] Compliance verification (SOC2, ISO 27001, etc.)
  [ ] Documentation review and updates

SECTION 9: SUCCESS CRITERIA
===============================================

Application Is Production-Ready When:

✅ All smoke tests pass
✅ No CSP violations in production
✅ Health endpoints properly protected
✅ Monitoring systems working
✅ Error rates normal or lower than baseline
✅ User authentication and authorization working
✅ API calls completing successfully
✅ Database and cache performing normally
✅ Security audit logs present and readable
✅ No performance degradation observed
✅ Rollback plan tested and documented

SECTION 10: CONTACT & ESCALATION
===============================================

For Questions About These Fixes:
  - CSP/Nonce: See src/hooks/useNonce.ts and middleware.ts
  - Health Endpoints: See backend/src/middleware/health-access.middleware.ts
  - Security Headers: See next.config.js

For Deployment Issues:
  - Check SECURITY-FIXES-TESTING-GUIDE.txt for detailed steps
  - Run SECURITY-FIXES-VERIFICATION.sh to validate implementation
  - Review error logs in backend/logs/ or CloudWatch

For Production Incidents:
  - See SECTION 6: ROLLBACK PLAN
  - Contact security team immediately if:
    - Unusual CSP violations detected
    - Health endpoint access anomalies
    - Failed authentication spike
    - Performance degradation

===============================================
END OF OPERATIONAL CHECKLIST
Version: 1.0 (January 3, 2026)
Status: PRODUCTION-READY
===============================================
